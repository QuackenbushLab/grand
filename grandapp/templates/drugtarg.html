{% load static %} 
{% include "header.html" %}
{% load widget_tweaks %}

<div class='container pt-3 pb-4'>
    <div class="card text-center">
        <div class="card-header">
            <ul class="nav nav-pills card-header-pills" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                </li>
                <li class="nav-item" role="presentation">
                  {% if activetab == 'tar' %}
                  <a class="nav-link active" id="profile-tab" data-bs-toggle="tab" href="#tar" role="tab" aria-controls="tar" aria-selected="false">Targeting</a>
                  {% else %}
                  <a class="nav-link" id="profile-tab" data-bs-toggle="tab" href="#tar" role="tab" aria-controls="tar" aria-selected="false">Targeting</a>
                  {% endif %}
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link disabled" id="profile-tab" data-bs-toggle="tab" role="tab" aria-selected="false">Input data:</a>
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="profile-tab" data-bs-toggle="tab" href="#ppi" role="tab" aria-controls="ppi" aria-selected="false">PPI</a>
                  <img src="{% static 'images/ppi.svg' %}" style="width: 65px; height:31px">
                </li>
                <li class="nav-item" role="presentation">
                  <a class="nav-link" id="contact-tab" data-bs-toggle="tab" href="#motif" role="tab" aria-controls="motif" aria-selected="false">Motif</a>
                  <img src="{% static 'images/motif.svg' %}" style="width: 75px; height:30px">
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="contact-tab" data-bs-toggle="tab" href="#coexpression" role="tab" aria-controls="coexpression" aria-selected="false" >Expression</a>
                    <img src="{% static 'images/coexpression.svg' %}" style="width: 115px; height:28px">
                </li>
              </ul>
        </div>
    



        <!-- NETWORK -->
        <div class="tab-content" id="myTabContent">
          {% if activetab == 'tar' %}
            <div class="tab-pane fade" id="network" role="tabpanel" aria-labelledby="home-tab">
          {% else %}
            <div class="tab-pane fade show active" id="network" role="tabpanel" aria-labelledby="home-tab">
          {% endif %}
                <div class='container'>
                  <div class="row">
                    <div class="col-2 border border-secondary">
                      <h5><span class="badge bg-secondary">Edges</span></h5>
                      <div>
                        <label for="myEdge" class="form-label">Number of edges</label>
                        <form action="{% url 'networksagg' slug %}" role="form" method="post">
                          {% csrf_token %}
                          {{ netform.nedges }}
                          <p>Value: <span id="demo2"></span></p>
                          <div class="form-group">
                            {% for radio in netform.topbottom %}
                              <small>{{ radio }}</small>
                            {% endfor %}
                          </div>
                          <div class='row'>
                            <div class='col-md-10 offset-md-2'>
                              <div style="float: left;">
                                {{ netform.brd }} <small>Weighted edges</small>
                              </div>
                              <div style="float: left;">
                                {{ netform.absval }} <small><a href="#"
                                  data-bs-toggle="popover"
                                  data-bs-animation="false"
                                  data-bs-placement="top"
                                  data-bs-html="true"
                                  data-bs-content="Absolute value of edges">
                                Absolute value</a></small>
                              </div>
                              <div style="float: left;">
                                {{ netform.edgetargeting }} <small><a href="#"
                                  data-bs-toggle="popover"
                                  data-bs-animation="false"
                                  data-bs-placement="top"
                                  data-bs-html="true"
                                  data-bs-content="Draws motif prior edges as dashed lines.">
                                Prior edges</a></small>
                              </div>
                            </div>
                          </div>
                        <br>
                          <h5><span class="badge bg-secondary">Node scaling</span></h5>
                          <div class='row'>
                            <div class='col-md-10 offset-md-2'>
                          <div style="float: left;">
                          {{ netform.dt.0 }} <small>No scaling</small>
                          </div>
                          <div style="float: left;">
                          {{ netform.dt.1 }} <small>Scale by <a href="#"
                            data-bs-toggle="popover"
                            data-bs-animation="false"
                            data-bs-placement="top"
                            data-bs-html="true"
                            data-bs-content="Scale node size by targeting score. More about targeting score in <a href='https://grand.networkmedicine.org/help/#wiki'>GRAND help page</a>">
                          targeting</a></small>
                        </div>
                        <div style="float: left;">
                          {{ netform.dt.2 }} <small>Scale by <a href="#"
                            data-bs-toggle="popover"
                            data-bs-animation="false"
                            data-bs-placement="top"
                            data-bs-html="true"
                            data-bs-content="Scale node size by average expression across samples for aggregate networks and by sample for single-sample networks.">
                          expression</a></small>
                        </div>
                        <div style="float: left;">
                          {{ netform.dt.3 }} <small>Scale by <a href="#"
                            data-bs-toggle="popover"
                            data-bs-animation="false"
                            data-bs-placement="top"
                            data-bs-html="true"
                            data-bs-content="Scale node size by betweness centrality measured in the selected subnetwork.">
                          betweeness</a></small>
                        </div>
                          </div>
                        </div>
                        <br>
                        <h5><span class="badge bg-secondary">Selection</span></h5>
                        <div class='row'>
                          <div class='col-md-10 offset-md-2'>
                        <div style="float: left;">
                        {{ netform.tfgenesel.0 }} <small>No selection</small>
                        </div>
                        <br>
                        <div style="float: left;">
                        {{ netform.tfgenesel.1 }} <small>by <a href="#"
                          data-bs-toggle="popover"
                          data-bs-animation="false"
                          data-bs-placement="top"
                          data-bs-html="true"
                          data-bs-content="Enter Gene names by ENSG ID, gene symbols, or mixed lists, with each gene in a new line">
                        gene</a></small>
                      </div>
                      <br>
                      {{ netform.geneform }}
                      <br>
                      <div style="float: left;">
                        {{ netform.tfgenesel.2 }} <small>by <a href="#"
                          data-bs-toggle="popover"
                          data-bs-animation="false"
                          data-bs-placement="top"
                          data-bs-html="true"
                          data-bs-content="Enter TF names by ENSG ID, gene symbols, or mixed lists, with TF in a new line">
                        TF</a></small>
                      </div>
                      <br>
                      {{ netform.tfform }}
                      <br>
                      <div style="float: left;">
                        {{ netform.tfgenesel.3 }} <small>by <a href="#"
                          data-bs-toggle="popover"
                          data-bs-animation="false"
                          data-bs-placement="top"
                          data-bs-html="true"
                          data-bs-content="Enter GO term ID for example GO:0060148. Please check <a href='https://grand.networkmedicine.org/pathways/'>the pathway page</a> for a full term list.">
                        GO</a></small>
                      </div>
                      <br>
                      {{ netform.goform }}
                      <br>
                      <div style="float: left;">
                        {{ netform.tfgenesel.4 }} <small>by <a href="#"
                          data-bs-toggle="popover"
                          data-bs-animation="false"
                          data-bs-placement="top"
                          data-bs-html="true"
                          data-bs-content="Enter GWAS catalog term for example AIDS progression. Please check <a href='https://grand.networkmedicine.org/gwascatalog/'>the GWAS catalog page</a> for a full term list.">
                        GWAS</a></small>
                      </div>
                      <br>
                      {{ netform.gwasform }}
                        </div>
                      </div>
                        <br>
                        <br>
                        <div class="form-actions button-box">
                          <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            Info
                            </button>
                            <a href="#" class="btn btn-outline-success" id="btn-download" download="subnetwork.png" >Save</a>
                          <button type="submit"  name="submit" class="btn btn-primary" id="btnFetch">
                            <span id="mySpinner" class="d-none">
                            <span class="spinner-border spinner-grow-sm text-light" role="status" aria-hidden="true"></span>
                            </span>
                            Submit</button>
                            </div>

                        </div>
                        </form>
                        <br>
                        <br>
                        <p id="selection"></p>
                      </div>
                    </div>
                    
                    <div class="col-10 border border-secondary padding-0">
                      <div id="mynetwork" width=100% height=100%></div> 
                      <div class="accordion" id="accordionExampleNN">
                        <div class="accordion-item">
                          <h2 class="accordion-header" id="headingOneNN">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOneNN" aria-expanded="true" aria-controls="collapseOneNN">
                              Configuration panel
                            </button>
                          </h2>
                          <div id="collapseOneNN" class="accordion-collapse collapse" aria-labelledby="headingOneNN" data-bs-parent="#accordionExampleNN">
                            <div class="accordion-body">
                              <div id="config"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                    <div class="card-body">
                    <h5 class="card-title">{{ cancerType }} cancer gene regulatory network</h5>
                    <p class="card-text">Aggregate network model of TCGA gene expression data set.</p>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">Network parameters</li>
                        <li class="list-group-item">TFs</li>
                        <li class="list-group-item">Genes</li>
                    </ul>
            </div>
            <div class="tab-pane fade" id="ppi" role="tabpanel" aria-labelledby="profile-tab">...</div>
            <div class="tab-pane fade" id="motif" role="tabpanel" aria-labelledby="contact-tab">...</div>

        <!-- Targeting -->
        {% if activetab == 'tar' %}
          <div class="tab-pane fade show active" id="tar" role="tabpanel" aria-labelledby="home-tab">
        {% else %}
        <div class="tab-pane fade " id="tar" role="tabpanel" aria-labelledby="home-tab">
        {% endif %}
          <div class='container'>
            <div class="row">
              <div class="col-2 border border-secondary">
                <h5><span class="badge bg-secondary">Genes</span></h5>
                <div>
                  <form action="{% url 'drugtarg' slug %}" role="form" method="post">
                    {% csrf_token %}
                    {{ tarform.nedgestar }}
                    <p>Value: <span id="demo2Tar"></span></p>
                    <div class="form-group">
                      {% for radio in tarform.topbottomtar %}
                        <small>{{ radio }}</small>
                      {% endfor %}
                    </div>
                    <div class='row'>
                      <div class='col-md-10 offset-md-2'>
                        <div style="float: left;">
                          {{ tarform.absvaltar }} <small><a href="#"
                            data-bs-toggle="popover"
                            data-bs-animation="false"
                            data-bs-placement="top"
                            data-bs-html="true"
                            data-bs-content="Absolute value of targeting score">
                          Absolute value</a></small>
                        </div>
                      </div>
                    </div>
                    <br>
                    <h5><span class="badge bg-secondary">Selection</span></h5>
                    <div class='row'>
                      <div class='col-md-10 offset-md-2'>
                    <div style="float: left;">
                    {{ tarform.tfgeneseltar.0 }} <small>No selection</small>
                    </div>
                    <br>
                    <div style="float: left;">
                    {{ tarform.tfgeneseltar.1 }} <small>by <a href="#"
                      data-bs-toggle="popover"
                      data-bs-animation="false"
                      data-bs-placement="top"
                      data-bs-html="true"
                      data-bs-content="Enter Gene names by ENSG ID, gene symbols, or mixed lists, with each gene in a new line">
                    gene</a></small>
                  </div>
                  <br>
                  {{ tarform.geneformtar }}
                  <br>
                  <div style="float: left;">
                    {{ tarform.tfgeneseltar.2 }} <small>by <a href="#"
                      data-bs-toggle="popover"
                      data-bs-animation="false"
                      data-bs-placement="top"
                      data-bs-html="true"
                      data-bs-content="Enter GO term ID for example GO:0060148. Please check <a href='https://grand.networkmedicine.org/pathways/'>the pathway page</a> for a full term list.">
                    GO</a></small>
                  </div>
                  <br>
                  {{ tarform.goformtar }}
                  <br>
                  <div style="float: left;">
                    {{ tarform.tfgeneseltar.3 }} <small>by <a href="#"
                      data-bs-toggle="popover"
                      data-bs-animation="false"
                      data-bs-placement="top"
                      data-bs-html="true"
                      data-bs-content="Enter GWAS catalog term for example AIDS progression. Please check <a href='https://grand.networkmedicine.org/gwas/'>the GWAS catalog page</a> for a full term list.">
                    GWAS</a></small>
                  </div>
                  <br>
                  {{ tarform.gwasformtar }}
                    </div>
                  </div>
                  <br>

                    <h5><span class="badge bg-secondary">TFs</span></h5>
                        {{ tarform.nedgestartf }}
                        <p>Value: <span id="demo2Tartf"></span></p>
                        <div class="form-group">
                          {% for radio in tarform.topbottomtartf %}
                            <small>{{ radio }}</small>
                          {% endfor %}
                        </div>
                        <div class='row'>
                          <div class='col-md-10 offset-md-2'>
                            <div style="float: left;">
                              {{ tarform.absvaltartf }} <small><a href="#"
                                data-bs-toggle="popover"
                                data-bs-animation="false"
                                data-bs-placement="top"
                                data-bs-html="true"
                                data-bs-content="Absolute value of targeting score">
                              Absolute value</a></small>
                            </div>
                          </div>
                        </div>
                  <br>
                  <br>
                  <div class="form-actions button-box">
                    <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                      <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        Info
                      </button>
                    <button type="submit"  name="submit" class="btn btn-primary" id="btnFetchTar">
                      <span id="mySpinnerTar" class="d-none">
                      <span class="spinner-border spinner-grow-sm text-light" role="status" aria-hidden="true"></span>
                      </span>
                      Submit</button>
                      </div>
                  </div>
                </form>
                  <br>
                  <h5><span class="badge bg-secondary">Analysis</span></h5>
                  <small>Analyze the submitted list of targeted genes/TFs for downstream analysis.</small>
                  <br>
                  <br>
                  <small>1. Enrichment analysis</small>
                  <div class="btn-group btn-group-sm" role="group" aria-label="Basic mixed styles example">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModalenrich">
                      Info
                    </button>
                    <a class="btn btn-outline-primary disabled" role="button">Enrich</a>
                    <a class="btn btn-outline-primary" href="{% url 'disease' %}" role="button">TFs</a>
                  </div>
                  <br><br>
                  <small>2. Drug repurposing</small>
                  <form action="{% url 'cluesubmit' 'redirect' %}" role="form" method="post">
                    {% csrf_token %}
                    {{ clueform.tfgeneselclue.0 }}<small>
                     By gene</small>
                    {{ clueform.tfgeneselclue.1 }}<small>
                     By TF</small>
                  <br><br>
                  <div class="btn-group btn-group-sm" role="group" aria-label="Basic mixed styles example">
                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModalclue">
                      Info
                    </button>
                    <button type="submit"  name="submit" class="btn btn-primary" id="btnFetchTarclue">
                      <span id="mySpinnerTar" class="d-none">
                      <span class="spinner-border spinner-grow-sm text-light" role="status" aria-hidden="true"></span>
                      </span>
                      CLUEreg</button>
                  </div>
                </form>
                  <br>
                  <br>
                </div>
              </div>
              <div class='col border border-secondary padding-0'> 
              <div class="row-4 ">
                <canvas id="tftardiv" style="width:100%; height:400px;"></canvas>
              </div>
              <div class="row-4 ">
                <canvas id="genetardiv" style="width:100%; height:400px;"></canvas>
              </div>
              </div>
            </div>
          </div>
          </div>
          </div>
      </div>
    

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Legend information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p style="text-align:left">Targeting refers to a bipartite network metric. For genes, targeting is the weighted indegree. For TFs, it represents the weighted outdegree.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Enrich-->
<div class="modal fade" id="exampleModalenrich" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p style="text-align:left">The enrich function submits the selected TFs for enrichment analysis.</p> 
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Enrich-->
<div class="modal fade" id="exampleModalclue" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p style="text-align:left">The CLUEreg function submits the selected TFs/Genes in CLUEreg, which finds optimal compounds that reverse the TF/Gene profile. High-targeted genes/TFs are those that have a positive z-score and low-targeted genes are those with negative z-score. CLUEreg requires both high-targeted and low-targeted genes/TFs to be nonempty sets.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


</div><!-- End div for container-->


{% include "footer.html" %}

<script>
  var slug="{{ slug }}";
  var slidertartf = document.getElementById("myEdgeTartf");
  var outputtartf = document.getElementById("demo2Tartf");
  outputtartf.innerHTML = slidertartf.value;
  
  slidertartf.oninput = function() {
    outputtartf.innerHTML = this.value;
  }
  var slidertar = document.getElementById("myEdgeTar");
  var outputtar = document.getElementById("demo2Tar");
  outputtar.innerHTML = slidertar.value;
  
  slidertar.oninput = function() {
    outputtar.innerHTML = this.value;
  }
  var slider = document.getElementById("myEdge");
  var output = document.getElementById("demo2");
  output.innerHTML = slider.value;
  
  slider.oninput = function() {
    output.innerHTML = this.value;
  }
  var nodes = JSON.parse("{{nodes|escapejs}}");  
  var edges = JSON.parse("{{edges|escapejs}}"); 
</script> 
<script>

  $(document).ready(function() {
      $("#btnFetch").click(function() {
          $("#mySpinner").removeClass("d-none")
      })
      $("#btnFetchTar").click(function() {
          $("#mySpinnerTar").removeClass("d-none")
      })
  });
  </script>
<script src="{% static 'js/networksagg.js' %}"></script>

<script>

  if(document.getElementById('absval')==null){
    if(slug.substr(0,3)=='ACH'){
      document.getElementById('id_edgetargeting').disabled = true; 
    }
    document.getElementById('id_absval').onchange = function() {
        document.getElementById('id_brd').checked = this.checked;

    };
  }else if(document.getElementById('id_absval')==null){
    if(slug.substr(0,3)=='ACH'){
      document.getElementById('edgetargeting').disabled = true; 
    }
    document.getElementById('absval').onchange = function() {
        document.getElementById('brd').checked = this.checked;
    };
  }
</script>

<script>
var tftarscore = JSON.parse("{{tftarscore|escapejs}}");  
var genetarscore = JSON.parse("{{genetarscore|escapejs}}"); 
</script>
<script src="{% static 'js/bartar.js' %}"></script>

</script> 
</body>
</html>